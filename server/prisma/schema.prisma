generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL")
}

enum PropertyCategory {
  RESIDENTIAL
  COMMERCIAL
}

enum ResidentialType {
  APARTMENT
  CONDO
  TOWNHOUSE
  MULTI_FAMILY
  SINGLE_FAMILY
  STUDIO
}

enum CommercialType {
  INDUSTRIAL
  OFFICE
  RETAIL
  SHOPPING_CENTER
  STORAGE
  PARKING_SPACE
  WAREHOUSE
}

enum RentCycle {
  MONTHLY
  QUARTERLY
  YEARLY
}

enum UserRole {
  ADMIN
  TENANT
}

enum MaintenanceStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum MaintenancePriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum LeaseStatus {
  DRAFT
  ACTIVE
  EXPIRED
  TERMINATED
}

model User {
  id           String     @id @default(cuid())
  email        String     @unique
  password     String
  firstName    String?
  lastName     String?
  phone        String?
  role         UserRole   @default(TENANT)
  resetToken   String?
  resetTokenExpiry DateTime?
  profileImage String?

  listings     Listing[]              @relation("LandlordListings")
  tenantLeases Lease[]                @relation("TenantLeases")
  landlordLeases Lease[]              @relation("LandlordLeases")
  maintenanceRequests MaintenanceRequest[]
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  @@map("users")
}
model Listing {
  id               String   @id @default(cuid())
  landlordId       String
  title            String
  description      String?
  category         PropertyCategory
  residentialType  ResidentialType?
  commercialType   CommercialType?
  address          String
  city             String
  state            String
  country          String
  zipCode          String?
  bedrooms         Int?
  bathrooms        Int?
  size             Int?
  yearBuilt        Int?
  rentAmount       Float
  rentCycle        RentCycle
  securityDeposit  Float?
  availableDate    DateTime
  landlord         User      @relation("LandlordListings", fields: [landlordId], references: [id])
  amenities        ListingAmenity[]
  images           ListingImage[]
  leases           Lease[]
  maintenanceRequests MaintenanceRequest[]
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([landlordId])
  @@index([city, category])
  @@index([rentCycle])
}


model ListingAmenity {
  id         String   @id @default(cuid())
  listingId  String
  name       String
  listing    Listing  @relation(fields: [listingId], references: [id])
  createdAt  DateTime @default(now())

  @@unique([listingId, name])
  @@index([listingId])
}

model ListingImage {
  id         String   @id @default(cuid())
  listingId  String
  url        String
  isPrimary  Boolean  @default(false)

  listing    Listing  @relation(fields: [listingId], references: [id])
  createdAt  DateTime @default(now())

  @@unique([listingId, url])
  @@index([listingId])
}


model Lease {
  id               String   @id @default(cuid())
  listingId        String
  tenantId         String
  landlordId       String
  startDate        DateTime
  endDate          DateTime
  rentAmount       Float
  paymentFrequency RentCycle
  securityDeposit  Float?
  paymentMethod    String?
  leaseStatus      LeaseStatus @default(ACTIVE)
  leaseDocument    String?
  signedContract   String?
  notes            String?

  listing          Listing  @relation(fields: [listingId], references: [id])
  tenant           User     @relation("TenantLeases", fields: [tenantId], references: [id])
  landlord         User     @relation("LandlordLeases", fields: [landlordId], references: [id])

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([tenantId])
  @@index([landlordId])
}


model MaintenanceRequest {
  id          String   @id @default(cuid())
  listingId   String
  tenantId    String
  description String
  status      MaintenanceStatus @default(OPEN)
  priority    MaintenancePriority?

  listing     Listing  @relation(fields: [listingId], references: [id])
  tenant      User     @relation(fields: [tenantId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}