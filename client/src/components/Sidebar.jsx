import { useState } from "react";
import { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from "@/components/ui/alert-dialog";
import { Menu, X, ChevronLeft, ChevronRight, HelpCircle, LogOut, User } from "lucide-react";
import { useAuthStore } from "../store/authStore";
import { useNavigate } from "react-router-dom";
import { useQueryClient } from "@tanstack/react-query";

const Sidebar = ({ navItems, activeNav, setActiveNav }) => {
  const { logout, user } = useAuthStore();
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [isCollapsed, setIsCollapsed] = useState(false);
  const [logoutOpen, setLogoutOpen] = useState(false);

  // Check if current page is Account (not accounting)
  const location = window.location.pathname;
  const isAccountActive = location === '/landlord/account' || location === '/tenant/account';

  const handleLogout = () => {
    // Clear all cached queries to prevent showing stale data on next login
    queryClient.clear();
    console.log('ðŸ§¹ Cleared all React Query cache on logout');
    
    logout();
    navigate("/login");
  };

  const handleNavClick = (id) => {
    setActiveNav(id);
    setIsMobileMenuOpen(false);
  };

  // const sidebarWidth = isCollapsed ? "w-[70px]" : "w-[220px]";

  return (
    <>
      {/* Mobile menu button */}
      <button
        onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
        className="lg:hidden fixed top-4 left-4 z-50 p-2 bg-gray-800 text-white rounded-lg shadow-lg cursor-pointer"
      >
        {isMobileMenuOpen ? <X size={24} /> : <Menu size={24} />}
      </button>

      {/* Overlay for mobile */}
      {isMobileMenuOpen && (
        <div
          className="lg:hidden fixed inset-0 bg-black bg-opacity-50 z-30"
          onClick={() => setIsMobileMenuOpen(false)}
        />
      )}

      {/* Sidebar container */}
      <div
        className={`
          bg-primary dark:bg-gray-950 dark:border-r dark:border-gray-800 fixed lg:static inset-y-0 left-0 z-40 flex flex-col justify-between
          text-white dark:text-gray-100 transform transition-all duration-300 ease-in-out
          ${isMobileMenuOpen
            ? "translate-x-0"
            : "-translate-x-full lg:translate-x-0"
          }
        `}
        style={{
          width: isCollapsed ? "70px" : "220px",
        }}
      >
        {/* Top section */}
        <div className="p-4 pr-0">
          {isCollapsed ? (
            <div className="mb-8 flex items-center justify-center">
              <button
                onClick={() => setIsCollapsed(false)}
                className="hidden lg:block p-2 hover:bg-gray-700 rounded-lg transition"
              >
                <ChevronRight size={20} />
              </button>
            </div>
          ) : (
            <div className="mb-8 flex items-center justify-between">
              <div className="whitespace-nowrap">
                <svg width="146" height="32" viewBox="0 0 146 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g clipPath="url(#clip0_2022_11575)">
                    <path d="M8.93529 25.3291V15.7338C8.93529 15.5693 9.31214 15.0203 9.43839 14.8596L18.0198 5.99706C18.4578 5.62978 19.0948 5.58195 19.6075 5.79046C22.0828 7.35332 24.6251 8.83775 27.066 10.4503C28.361 11.3054 29.4552 11.688 29.591 13.4326C29.8952 17.291 29.3672 21.5529 29.5757 25.4534C29.4973 26.6853 28.4337 27.571 27.2286 27.0909C24.5007 25.1837 21.5242 23.5711 18.8194 21.639C18.3488 21.3024 17.7749 20.8586 17.6066 20.2808C17.377 19.4966 17.3828 16.1375 17.6066 15.3168C17.9165 14.1786 19.751 13.9701 20.5027 14.8137C21.2545 15.6573 20.6979 17.9165 20.8872 18.9743L26.1918 22.3908V13.8515L19.4621 9.60674L19.1886 9.54935L12.2791 16.7859L12.2293 28.7647C12.0228 29.9239 10.7794 30.5953 9.73107 29.9947L0.996664 23.9479C-0.263952 23.0412 0.11672 21.7079 0.126284 20.4186C0.149239 17.2144 -0.162567 13.3216 0.118633 10.2189C0.200888 9.30259 0.753723 8.76314 1.36012 8.15483C3.34765 6.15965 5.5456 4.21804 7.60773 2.28407C8.85304 1.11719 9.87263 -0.744084 11.7741 0.315675C12.8664 0.923984 15.2518 2.34337 16.1394 3.11046C17.4382 4.23143 16.5086 6.38729 14.8615 6.13287C14.6492 6.10035 14.4235 5.94541 14.2322 5.84593C13.1629 5.2931 12.0897 4.41507 11.0414 3.79528L10.8616 3.78572L4.75556 9.53405L3.44521 10.8865V21.4994L3.70919 21.7863L8.93338 25.3291H8.93529Z" fill="#FFBA53"/>
                    <path d="M36.1061 19.0851V25.3748C36.1061 26.0386 34.945 26.7138 34.3156 26.7138C33.6863 26.7138 32.5251 26.0386 32.5251 25.3748V15.4123H40.8329C41.3475 15.4123 42.5603 14.6892 42.9467 14.3123C46.0265 11.3186 42.83 6.10016 38.6771 7.65346C37.3897 8.13551 36.1061 9.74619 36.1061 11.1407V13.6658H32.5251V10.498C32.5251 8.18525 34.8837 5.43255 36.8981 4.49714C43.8936 1.24517 50.7935 9.28135 46.4608 15.7145C43.9759 19.4045 40.1194 19.1846 36.1042 19.0832L36.1061 19.0851Z" fill="#FFBA53"/>
                    <path d="M101.191 5.12866V8.61783H93.113V14.0352H97.2889C97.5893 14.0352 98.1765 14.3566 98.3946 14.5823C99.2286 15.4489 99.0125 16.983 97.9183 17.5091C97.8303 17.5512 97.4324 17.708 97.3827 17.708H93.1149V23.1254H99.5863C99.8618 23.1254 100.438 23.4258 100.646 23.6266C101.277 24.2388 101.375 25.1704 100.904 25.9107C100.747 26.1593 100.145 26.7064 99.8637 26.7064H89.5359V5.12866H101.195H101.191Z" fill="#FFBA53"/>
                    <path d="M76.4059 26.7062V31.8482H72.8249V23.2171C73.1769 23.2668 73.5289 23.1711 73.8656 23.1597C76.0558 23.0774 78.9061 23.4734 81.0333 23.1176C86.1676 22.2625 84.6219 14.1345 79.4302 15.3626C78.1562 15.6648 76.4059 17.2067 76.4059 18.5801V21.4725H72.9627C72.9531 21.4725 72.8249 21.3443 72.8249 21.3347V18.5801C72.8249 15.9652 75.2486 13.1417 77.5996 12.2464C84.5282 9.61044 90.6821 17.4687 86.4315 23.5595C85.4406 24.9789 83.0017 26.7062 81.2246 26.7062H76.4059Z" fill="#FFBA53"/>
                    <path d="M141.95 17.4322C141.018 15.3241 138.063 14.6317 136.228 15.9784C134.04 17.5852 133.963 20.709 136.123 22.3886C138.068 23.8998 140.995 22.446 142.411 23.5363C143.624 24.4698 143.126 26.5281 141.537 26.706C138.088 27.0944 135.01 26.4899 132.722 23.7678C128.05 18.2127 133.495 10.1956 140.446 12.0014C143.945 12.91 146.629 16.7627 145.869 20.3857C145.829 20.5732 145.833 20.9386 145.655 20.9979L137.889 20.9864C136.504 20.841 135.74 19.2533 136.626 18.1189C136.817 17.8741 137.481 17.4303 137.774 17.4303H141.95V17.4322Z" fill="#FFBA53"/>
                    <path d="M112.024 22.5742V26.4306C107.594 27.7486 102.729 24.6248 102.381 19.9611C101.761 11.6476 112.538 8.56009 116.445 15.9937C117.569 18.1343 117.56 22.4039 117.351 24.8276C117.129 27.4043 114.002 27.1843 113.768 25.0992C113.422 22.0137 115.056 16.8163 111.155 15.5002C106.916 14.0712 103.942 19.5977 107.431 22.3465C108.78 23.4101 110.551 23.3432 112.024 22.5742Z" fill="#FFBA53"/>
                    <path d="M62.9845 11.7662C67.8012 11.3473 71.8375 15.5825 71.0551 20.3897C70.0297 26.6851 62.1064 28.9615 57.9573 24.0874C54.0396 19.4849 56.9779 12.2904 62.9845 11.7681V11.7662ZM63.3536 15.2535C57.8769 15.6341 59.0553 24.2959 64.4957 23.1003C69.2225 22.0616 68.2297 14.9149 63.3536 15.2535Z" fill="#FFBA53"/>
                    <path d="M129.649 11.7395V15.2287L123.647 15.2382C122.105 15.4334 122.216 17.2851 123.45 17.4343C124.567 17.5701 125.458 17.3118 126.644 17.7269C130.836 19.1999 130.549 25.4207 126.323 26.5474C125.231 26.8382 121.818 26.8172 120.601 26.71C118.522 26.5264 118.52 23.5633 120.259 23.2381C121.659 22.976 123.519 23.4045 124.988 23.1941C126.457 22.9837 126.449 21.3252 125.428 21.0573C124.701 20.8661 123.528 21.0688 122.648 20.8986C118.84 20.1602 117.677 15.1866 120.699 12.7514C121.206 12.344 122.445 11.7395 123.084 11.7395H129.648H129.649Z" fill="#FFBA53"/>
                    <path d="M55.3845 11.7395V15.1828C55.3845 15.3645 54.671 15.3148 54.4625 15.3626C49.9939 16.3688 51.8609 22.0215 51.4305 25.1835C51.155 27.2093 48.0561 27.2514 47.8552 25.0114C47.7118 23.4122 47.75 20.6595 47.8552 19.0354C48.0982 15.2612 51.5472 11.7395 55.3864 11.7395H55.3845Z" fill="#FFBA53"/>
                  </g>
                  <defs>
                    <clipPath id="clip0_2022_11575">
                      <rect width="146" height="31.8483" fill="white"/>
                    </clipPath>
                  </defs>
                </svg>
              </div>
              <button
                onClick={() => setIsCollapsed(true)}
                className="hidden lg:block p-2 hover:bg-gray-700 rounded-lg transition"
              >
                <ChevronLeft size={20} />
              </button>
            </div>
          )}

          {/* Nav Items */}
          <nav className="flex-1 space-y-2 overflow-y-auto">
            {navItems.map((item, index) => {
              const activeIndex = navItems.findIndex((nav) => nav.id === activeNav);
              const isActive = activeNav === item.id;
              const isBeforeActive = activeIndex !== -1 && index === activeIndex - 1;
              const isAfterActive = activeIndex !== -1 && index === activeIndex + 1;

              return (
                <button
                  key={item.id}
                  onClick={() => handleNavClick(item.id)}
                  className={`w-full flex items-center ${
                    isCollapsed 
                      ? "justify-center px-0" 
                      : "space-x-3"
                    } ${
                    !isCollapsed && isActive 
                      ? "pl-3 pr-0" 
                      : !isCollapsed 
                      ? "px-3" 
                      : ""
                    } py-2.5 rounded-tl-full rounded-bl-full transition-all duration-200 ease-in-out cursor-pointer ${isActive
                      ? "bg-background"
                      : "hover:bg-gray-300/10 active:bg-gray-300/20"
                    } relative overflow-visible`}
                >
                  {/* Background overlay for clipped-in rounded corners on adjacent items - matching active color */}
                  {/* {isBeforeActive && (
                    <div className="absolute -right-4 bottom-0 w-8 h-8 bg-white border-white">
                      <div className="absolute right-0 bottom-0 w-8 h-8 bg-primary rounded-br-full"></div>
                    </div>
                  )} */}
                  {/* {isAfterActive && (
                    <div className="absolute -right-4 top-0 w-8 h-8 bg-white border-white">
                      <div className="absolute right-0 top-0 w-8 h-8 bg-primary rounded-tr-full"></div>
                    </div>
                  )} */}

                  <div className="w-6 h-6 flex-shrink-0 relative z-10 flex items-center justify-center transition-all duration-200 ease-in-out">
                    {item.id === "dashboard" ? (
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 30 30"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        className={`${isActive ? "text-primary" : "text-background"}`}
                      >
                        <path
                          d="M17.75 11.5C17.3958 11.5 17.0992 11.38 16.86 11.14C16.6208 10.9 16.5008 10.6033 16.5 10.25V5.25C16.5 4.89583 16.62 4.59917 16.86 4.36C17.1 4.12083 17.3967 4.00083 17.75 4H25.25C25.6042 4 25.9012 4.12 26.1412 4.36C26.3812 4.6 26.5008 4.89667 26.5 5.25V10.25C26.5 10.6042 26.38 10.9013 26.14 11.1413C25.9 11.3813 25.6033 11.5008 25.25 11.5H17.75ZM5.25 16.5C4.89583 16.5 4.59917 16.38 4.36 16.14C4.12083 15.9 4.00083 15.6033 4 15.25V5.25C4 4.89583 4.12 4.59917 4.36 4.36C4.6 4.12083 4.89667 4.00083 5.25 4H12.75C13.1042 4 13.4013 4.12 13.6413 4.36C13.8813 4.6 14.0008 4.89667 14 5.25V15.25C14 15.6042 13.88 15.9013 13.64 16.1413C13.4 16.3813 13.1033 16.5008 12.75 16.5H5.25ZM17.75 26.5C17.3958 26.5 17.0992 26.38 16.86 26.14C16.6208 25.9 16.5008 25.6033 16.5 25.25V15.25C16.5 14.8958 16.62 14.5992 16.86 14.36C17.1 14.1208 17.3967 14.0008 17.75 14H25.25C25.6042 14 25.9012 14.12 26.1412 14.36C26.3812 14.6 26.5008 14.8967 26.5 15.25V25.25C26.5 25.6042 26.38 25.9012 26.14 26.1412C25.9 26.3812 25.6033 26.5008 25.25 26.5H17.75ZM5.25 26.5C4.89583 26.5 4.59917 26.38 4.36 26.14C4.12083 25.9 4.00083 25.6033 4 25.25V20.25C4 19.8958 4.12 19.5992 4.36 19.36C4.6 19.1208 4.89667 19.0008 5.25 19H12.75C13.1042 19 13.4013 19.12 13.6413 19.36C13.8813 19.6 14.0008 19.8967 14 20.25V25.25C14 25.6042 13.88 25.9012 13.64 26.1412C13.4 26.3813 13.1033 26.5008 12.75 26.5H5.25Z"
                          fill="currentColor"
                        />
                      </svg>
                    ) : item.id === "portfolio" ? (
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 27 26"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        className={`${isActive ? "text-primary" : "text-background"}`}
                      >
                        <path d="M22.5 16.3125C22.5 15.6458 22.3021 14.9792 21.9062 14.3125C21.5104 13.6458 20.9375 13.1667 20.1875 12.875L10.4375 9.00001L10 8.87501C9.85417 8.83335 9.6875 8.81251 9.5 8.81251H7.5V6.96876C7.5 6.5521 7.59375 6.16668 7.78125 5.81251C7.96875 5.45835 8.22917 5.16668 8.5625 4.93751L14.8125 0.468764C15.0417 0.302097 15.2762 0.182097 15.5163 0.108764C15.7563 0.0354306 16.0008 -0.000819288 16.25 1.4045e-05C16.4992 0.000847378 16.7492 0.0375141 17 0.110014C17.2508 0.182514 17.48 0.302097 17.6875 0.468764L23.9375 4.93751C24.2708 5.16668 24.5312 5.45835 24.7188 5.81251C24.9062 6.16668 25 6.5521 25 6.96876V16.3125H22.5ZM17.5 7.56251C17.6667 7.56251 17.8125 7.50001 17.9375 7.37501C18.0625 7.25001 18.125 7.10418 18.125 6.93751C18.125 6.77085 18.0625 6.62501 17.9375 6.50001C17.8125 6.37501 17.6667 6.31251 17.5 6.31251C17.3333 6.31251 17.1875 6.37501 17.0625 6.50001C16.9375 6.62501 16.875 6.77085 16.875 6.93751C16.875 7.10418 16.9375 7.25001 17.0625 7.37501C17.1875 7.50001 17.3333 7.56251 17.5 7.56251ZM15 7.56251C15.1667 7.56251 15.3125 7.50001 15.4375 7.37501C15.5625 7.25001 15.625 7.10418 15.625 6.93751C15.625 6.77085 15.5625 6.62501 15.4375 6.50001C15.3125 6.37501 15.1667 6.31251 15 6.31251C14.8333 6.31251 14.6875 6.37501 14.5625 6.50001C14.4375 6.62501 14.375 6.77085 14.375 6.93751C14.375 7.10418 14.4375 7.25001 14.5625 7.37501C14.6875 7.50001 14.8333 7.56251 15 7.56251ZM17.5 10.0625C17.6667 10.0625 17.8125 10 17.9375 9.87501C18.0625 9.75001 18.125 9.60418 18.125 9.43751C18.125 9.27085 18.0625 9.12501 17.9375 9.00001C17.8125 8.87501 17.6667 8.81251 17.5 8.81251C17.3333 8.81251 17.1875 8.87501 17.0625 9.00001C16.9375 9.12501 16.875 9.27085 16.875 9.43751C16.875 9.60418 16.9375 9.75001 17.0625 9.87501C17.1875 10 17.3333 10.0625 17.5 10.0625ZM15 10.0625C15.1667 10.0625 15.3125 10 15.4375 9.87501C15.5625 9.75001 15.625 9.60418 15.625 9.43751C15.625 9.27085 15.5625 9.12501 15.4375 9.00001C15.3125 8.87501 15.1667 8.81251 15 8.81251C14.8333 8.81251 14.6875 8.87501 14.5625 9.00001C14.4375 9.12501 14.375 9.27085 14.375 9.43751C14.375 9.60418 14.4375 9.75001 14.5625 9.87501C14.6875 10 14.8333 10.0625 15 10.0625ZM15.4688 24.8438C15.6979 24.9063 15.9637 24.9325 16.2662 24.9225C16.5687 24.9125 16.8237 24.8654 17.0312 24.7813L26.25 21.3125C26.25 20.6042 26 20.0104 25.5 19.5313C25 19.0521 24.4167 18.8125 23.75 18.8125H15.1875C15.125 18.8125 15.0521 18.8075 14.9688 18.7975C14.8854 18.7875 14.8229 18.7717 14.7812 18.75L12.9375 18.0938C12.7708 18.0313 12.6562 17.9271 12.5938 17.7813C12.5312 17.6354 12.5208 17.4792 12.5625 17.3125C12.6042 17.1667 12.7083 17.0521 12.875 16.9688C13.0417 16.8854 13.2083 16.875 13.375 16.9375L14.7812 17.4688C14.8646 17.5104 14.9325 17.5367 14.985 17.5475C15.0375 17.5583 15.1154 17.5633 15.2188 17.5625H18.5C18.8958 17.5625 19.2446 17.4271 19.5462 17.1563C19.8479 16.8854 19.9992 16.5313 20 16.0938C20 15.8021 19.9113 15.5208 19.7338 15.25C19.5563 14.9792 19.3221 14.7917 19.0312 14.6875L10.375 11.4688C10.2292 11.4271 10.0833 11.3904 9.9375 11.3588C9.79167 11.3271 9.64583 11.3117 9.5 11.3125H7.5V22.5938L15.4688 24.8438ZM0 22.5625C0 23.25 0.245 23.8388 0.735 24.3288C1.225 24.8188 1.81333 25.0633 2.5 25.0625C3.18667 25.0617 3.77542 24.8171 4.26625 24.3288C4.75708 23.8404 5.00167 23.2517 5 22.5625V13.8125C5 13.125 4.75542 12.5367 4.26625 12.0475C3.77708 11.5583 3.18833 11.3133 2.5 11.3125C1.81167 11.3117 1.22333 11.5567 0.735 12.0475C0.246667 12.5383 0.00166667 13.1267 0 13.8125V22.5625Z" fill="currentColor"/>
                      </svg>
                    ) : item.id === "applications" ? (
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 30 30"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        className={`${isActive ? "text-primary" : "text-background"}`}
                      >
                        <g clipPath="url(#clip0_app_icon)">
                          <path
                            d="M15.625 14.9375C16.2292 14.2708 16.6929 13.5104 17.0163 12.6562C17.3396 11.8021 17.5008 10.9167 17.5 10C17.4992 9.08333 17.3379 8.19792 17.0163 7.34375C16.6946 6.48958 16.2308 5.72917 15.625 5.0625C16.875 5.22917 17.9167 5.78125 18.75 6.71875C19.5833 7.65625 20 8.75 20 10C20 11.25 19.5833 12.3438 18.75 13.2812C17.9167 14.2188 16.875 14.7708 15.625 14.9375ZM21.8125 25C22.0417 24.625 22.2138 24.2242 22.3288 23.7975C22.4438 23.3708 22.5008 22.9383 22.5 22.5V21.25C22.5 20.5 22.3333 19.7862 22 19.1087C21.6667 18.4312 21.2292 17.8325 20.6875 17.3125C21.75 17.6875 22.7346 18.1721 23.6413 18.7662C24.5479 19.3604 25.0008 20.1883 25 21.25V22.5C25 23.1875 24.7554 23.7763 24.2663 24.2663C23.7771 24.7563 23.1883 25.0008 22.5 25H21.8125ZM25 13.75H23.75C23.3958 13.75 23.0992 13.63 22.86 13.39C22.6208 13.15 22.5008 12.8533 22.5 12.5C22.4992 12.1467 22.6192 11.85 22.86 11.61C23.1008 11.37 23.3975 11.25 23.75 11.25H25V10C25 9.64583 25.12 9.34917 25.36 9.11C25.6 8.87083 25.8967 8.75083 26.25 8.75C26.6033 8.74917 26.9004 8.86917 27.1412 9.11C27.3821 9.35083 27.5017 9.6475 27.5 10V11.25H28.75C29.1042 11.25 29.4012 11.37 29.6412 11.61C29.8812 11.85 30.0008 12.1467 30 12.5C29.9992 12.8533 29.8792 13.1504 29.64 13.3913C29.4008 13.6321 29.1042 13.7517 28.75 13.75H27.5V15C27.5 15.3542 27.38 15.6513 27.14 15.8913C26.9 16.1313 26.6033 16.2508 26.25 16.25C25.8967 16.2492 25.6 16.1292 25.36 15.89C25.12 15.6508 25 15.3542 25 15V13.75ZM10 15C8.625 15 7.44792 14.5104 6.46875 13.5312C5.48958 12.5521 5 11.375 5 10C5 8.625 5.48958 7.44792 6.46875 6.46875C7.44792 5.48958 8.625 5 10 5C11.375 5 12.5521 5.48958 13.5312 6.46875C14.5104 7.44792 15 8.625 15 10C15 11.375 14.5104 12.5521 13.5312 13.5312C12.5521 14.5104 11.375 15 10 15ZM0 22.5V21.5C0 20.7917 0.1825 20.1408 0.5475 19.5475C0.9125 18.9542 1.39667 18.5008 2 18.1875C3.29167 17.5417 4.60417 17.0575 5.9375 16.735C7.27083 16.4125 8.625 16.2508 10 16.25C11.375 16.2492 12.7292 16.4108 14.0625 16.735C15.3958 17.0592 16.7083 17.5433 18 18.1875C18.6042 18.5 19.0887 18.9533 19.4538 19.5475C19.8188 20.1417 20.0008 20.7925 20 21.5V22.5C20 23.1875 19.7554 23.7763 19.2663 24.2663C18.7771 24.7563 18.1883 25.0008 17.5 25H2.5C1.8125 25 1.22417 24.7554 0.735 24.2663C0.245833 23.7771 0.000833333 23.1883 0 22.5Z"
                            fill="currentColor"
                          />
                        </g>
                        <defs>
                          <clipPath id="clip0_app_icon">
                            <rect width="30" height="30" fill="white" />
                          </clipPath>
                        </defs>
                      </svg>
                    ) : item.id === "maintenance" ? (
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 30 30"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        className={`${isActive ? "text-primary" : "text-background"}`}
                      >
                        <path
                          d="M11.25 18.75C9.16667 18.75 7.39583 18.0208 5.9375 16.5625C4.47917 15.1042 3.75 13.3333 3.75 11.25C3.75 10.8333 3.78125 10.4167 3.84375 10C3.90625 9.58333 4.02083 9.1875 4.1875 8.8125C4.29167 8.60417 4.42208 8.44792 4.57875 8.34375C4.73542 8.23958 4.90708 8.16667 5.09375 8.125C5.28042 8.08333 5.47333 8.08875 5.6725 8.14125C5.87167 8.19375 6.05375 8.30292 6.21875 8.46875L9.5 11.75L11.75 9.5L8.46875 6.21875C8.30208 6.05208 8.19292 5.87 8.14125 5.6725C8.08958 5.475 8.08417 5.28208 8.125 5.09375C8.16583 4.90542 8.23875 4.73333 8.34375 4.5775C8.44875 4.42167 8.605 4.29167 8.8125 4.1875C9.1875 4.02083 9.58333 3.90625 10 3.84375C10.4167 3.78125 10.8333 3.75 11.25 3.75C13.3333 3.75 15.1042 4.47917 16.5625 5.9375C18.0208 7.39583 18.75 9.16667 18.75 11.25C18.75 11.7292 18.7083 12.1825 18.625 12.61C18.5417 13.0375 18.4167 13.4592 18.25 13.875L24.5625 20.125C25.1667 20.7292 25.4688 21.4688 25.4688 22.3438C25.4688 23.2188 25.1667 23.9583 24.5625 24.5625C23.9583 25.1667 23.2188 25.4688 22.3438 25.4688C21.4688 25.4688 20.7292 25.1562 20.125 24.5312L13.875 18.25C13.4583 18.4167 13.0367 18.5417 12.61 18.625C12.1833 18.7083 11.73 18.75 11.25 18.75Z"
                          fill="currentColor"
                        />
                      </svg>
                    ) : item.id === "insurance" ? (
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 44 36"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        className={`${isActive ? "text-primary" : "text-background"}`}
                      >
                        <path d="M0 18.05C0 17.3833 0.15 16.7667 0.45 16.2C0.75 15.6333 1.16667 15.1667 1.7 14.8L11.7 7.65C12.0667 7.38333 12.442 7.19133 12.826 7.074C13.21 6.95667 13.6013 6.89867 14 6.9C14.3987 6.90133 14.7907 6.96 15.176 7.076C15.5613 7.192 15.936 7.38333 16.3 7.65L26.3 14.8C26.8333 15.1667 27.25 15.6333 27.55 16.2C27.85 16.7667 28 17.3833 28 18.05V32C28 33.1 27.6087 34.042 26.826 34.826C26.0433 35.61 25.1013 36.0013 24 36H22C20.9 36 19.9587 35.6087 19.176 34.826C18.3933 34.0433 18.0013 33.1013 18 32V27C18 26.1667 17.7087 25.4587 17.126 24.876C16.5433 24.2933 15.8347 24.0013 15 24H13C12.1667 24 11.4587 24.292 10.876 24.876C10.2933 25.46 10.0013 26.168 10 27V32C10 33.1 9.60867 34.042 8.826 34.826C8.04333 35.61 7.10133 36.0013 6 36H4C2.9 36 1.95867 35.6087 1.176 34.826C0.393333 34.0433 0.00133333 33.1013 0 32V18.05ZM44 4V32C44 33.1 43.6087 34.042 42.826 34.826C42.0433 35.61 41.1013 36.0013 40 36H34C33.4333 36 32.9587 35.808 32.576 35.424C32.1933 35.04 32.0013 34.5653 32 34V16.05C32 15.3833 31.858 14.7667 31.574 14.2C31.29 13.6333 30.882 13.1667 30.35 12.8L19.9 5.3C19.4667 4.96667 19.1167 4.56667 18.85 4.1C18.5833 3.63333 18.45 3.16667 18.45 2.7C18.45 1.86667 18.7167 1.20867 19.25 0.726C19.7833 0.243333 20.5 0.00133333 21.4 0H40C41.1 0 42.042 0.392 42.826 1.176C43.61 1.96 44.0013 2.90133 44 4ZM33 12H35C35.2667 12 35.5 11.9 35.7 11.7C35.9 11.5 36 11.2667 36 11V9C36 8.73333 35.9 8.5 35.7 8.3C35.5 8.1 35.2667 8 35 8H33C32.7333 8 32.5 8.1 32.3 8.3C32.1 8.5 32 8.73333 32 9V11C32 11.2667 32.1 11.5 32.3 11.7C32.5 11.9 32.7333 12 33 12ZM33 20H35C35.2667 20 35.5 19.9 35.7 19.7C35.9 19.5 36 19.2667 36 19V17C36 16.7333 35.9 16.5 35.7 16.3C35.5 16.1 35.2667 16 35 16H33C32.7333 16 32.5 16.1 32.3 16.3C32.1 16.5 32 16.7333 32 17V19C32 19.2667 32.1 19.5 32.3 19.7C32.5 19.9 32.7333 20 33 20ZM33 28H35C35.2667 28 35.5 27.9 35.7 27.7C35.9 27.5 36 27.2667 36 27V25C36 24.7333 35.9 24.5 35.7 24.3C35.5 24.1 35.2667 24 35 24H33C32.7333 24 32.5 24.1 32.3 24.3C32.1 24.5 32 24.7333 32 25V27C32 27.2667 32.1 27.5 32.3 27.7C32.5 27.9 32.7333 28 33 28Z" fill="currentColor"/>
                      </svg>
                    ) : item.id === "rental-info" ? (
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 44 36"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        className={`${isActive ? "text-primary" : "text-background"}`}
                      >
                        <path d="M0 18.05C0 17.3833 0.15 16.7667 0.45 16.2C0.75 15.6333 1.16667 15.1667 1.7 14.8L11.7 7.65C12.0667 7.38333 12.442 7.19133 12.826 7.074C13.21 6.95667 13.6013 6.89867 14 6.9C14.3987 6.90133 14.7907 6.96 15.176 7.076C15.5613 7.192 15.936 7.38333 16.3 7.65L26.3 14.8C26.8333 15.1667 27.25 15.6333 27.55 16.2C27.85 16.7667 28 17.3833 28 18.05V32C28 33.1 27.6087 34.042 26.826 34.826C26.0433 35.61 25.1013 36.0013 24 36H22C20.9 36 19.9587 35.6087 19.176 34.826C18.3933 34.0433 18.0013 33.1013 18 32V27C18 26.1667 17.7087 25.4587 17.126 24.876C16.5433 24.2933 15.8347 24.0013 15 24H13C12.1667 24 11.4587 24.292 10.876 24.876C10.2933 25.46 10.0013 26.168 10 27V32C10 33.1 9.60867 34.042 8.826 34.826C8.04333 35.61 7.10133 36.0013 6 36H4C2.9 36 1.95867 35.6087 1.176 34.826C0.393333 34.0433 0.00133333 33.1013 0 32V18.05ZM44 4V32C44 33.1 43.6087 34.042 42.826 34.826C42.0433 35.61 41.1013 36.0013 40 36H34C33.4333 36 32.9587 35.808 32.576 35.424C32.1933 35.04 32.0013 34.5653 32 34V16.05C32 15.3833 31.858 14.7667 31.574 14.2C31.29 13.6333 30.882 13.1667 30.35 12.8L19.9 5.3C19.4667 4.96667 19.1167 4.56667 18.85 4.1C18.5833 3.63333 18.45 3.16667 18.45 2.7C18.45 1.86667 18.7167 1.20867 19.25 0.726C19.7833 0.243333 20.5 0.00133333 21.4 0H40C41.1 0 42.042 0.392 42.826 1.176C43.61 1.96 44.0013 2.90133 44 4ZM33 12H35C35.2667 12 35.5 11.9 35.7 11.7C35.9 11.5 36 11.2667 36 11V9C36 8.73333 35.9 8.5 35.7 8.3C35.5 8.1 35.2667 8 35 8H33C32.7333 8 32.5 8.1 32.3 8.3C32.1 8.5 32 8.73333 32 9V11C32 11.2667 32.1 11.5 32.3 11.7C32.5 11.9 32.7333 12 33 12ZM33 20H35C35.2667 20 35.5 19.9 35.7 19.7C35.9 19.5 36 19.2667 36 19V17C36 16.7333 35.9 16.5 35.7 16.3C35.5 16.1 35.2667 16 35 16H33C32.7333 16 32.5 16.1 32.3 16.3C32.1 16.5 32 16.7333 32 17V19C32 19.2667 32.1 19.5 32.3 19.7C32.5 19.9 32.7333 20 33 20ZM33 28H35C35.2667 28 35.5 27.9 35.7 27.7C35.9 27.5 36 27.2667 36 27V25C36 24.7333 35.9 24.5 35.7 24.3C35.5 24.1 35.2667 24 35 24H33C32.7333 24 32.5 24.1 32.3 24.3C32.1 24.5 32 24.7333 32 25V27C32 27.2667 32.1 27.5 32.3 27.7C32.5 27.9 32.7333 28 33 28Z" fill="currentColor"/>
                      </svg>
                    ) : item.id === "accounting" ? (
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 30 30"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        className={`${isActive ? "text-primary" : "text-background"}`}
                      >
                        <path d="M6.25 26.25C5.5625 26.25 4.97417 26.0054 4.485 25.5163C3.99583 25.0271 3.75083 24.4383 3.75 23.75V6.25C3.75 5.5625 3.995 4.97417 4.485 4.485C4.975 3.99583 5.56333 3.75083 6.25 3.75H23.75C24.4375 3.75 25.0263 3.995 25.5163 4.485C26.0063 4.975 26.2508 5.56333 26.25 6.25H16.25C14.7708 6.25 13.5679 6.71375 12.6412 7.64125C11.7146 8.56875 11.2508 9.77167 11.25 11.25V18.75C11.25 20.2292 11.7137 21.4325 12.6412 22.36C13.5687 23.2875 14.7717 23.7508 16.25 23.75H26.25C26.25 24.4375 26.0054 25.0263 25.5163 25.5163C25.0271 26.0063 24.4383 26.2508 23.75 26.25H6.25ZM16.25 21.25C15.5625 21.25 14.9742 21.0054 14.485 20.5163C13.9958 20.0271 13.7508 19.4383 13.75 18.75V11.25C13.75 10.5625 13.995 9.97417 14.485 9.485C14.975 8.99583 15.5633 8.75083 16.25 8.75H25C25.6875 8.75 26.2763 8.995 26.7663 9.485C27.2563 9.975 27.5008 10.5633 27.5 11.25V18.75C27.5 19.4375 27.2554 20.0263 26.7663 20.5163C26.2771 21.0063 25.6883 21.2508 25 21.25H16.25ZM20 16.875C20.5417 16.875 20.9896 16.6979 21.3438 16.3438C21.6979 15.9896 21.875 15.5417 21.875 15C21.875 14.4583 21.6979 14.0104 21.3438 13.6562C20.9896 13.3021 20.5417 13.125 20 13.125C19.4583 13.125 19.0104 13.3021 18.6562 13.6562C18.3021 14.0104 18.125 14.4583 18.125 15C18.125 15.5417 18.3021 15.9896 18.6562 16.3438C19.0104 16.6979 19.4583 16.875 20 16.875Z" fill="currentColor"/>
                      </svg>
                    ) : item.id === "leases" ? (
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 44 40"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        className={`${isActive ? "text-primary" : "text-background"}`}
                      >
                        <path d="M4 32C2.9 32 1.95867 31.6087 1.176 30.826C0.393333 30.0433 0.00133333 29.1013 0 28V4C0 2.9 0.392 1.95867 1.176 1.176C1.96 0.393333 2.90133 0.00133333 4 0H36C37.1 0 38.042 0.392 38.826 1.176C39.61 1.96 40.0013 2.90133 40 4V14C40 14.5667 39.808 15.042 39.424 15.426C39.04 15.81 38.5653 16.0013 38 16H33C31.0667 16 29.4167 16.6833 28.05 18.05C26.6833 19.4167 26 21.0667 26 23V30C26 30.5667 25.808 31.042 25.424 31.426C25.04 31.81 24.5653 32.0013 24 32H4ZM20 14L6.6 5.6C6.03333 5.23333 5.45867 5.21667 4.876 5.55C4.29333 5.88333 4.00133 6.38333 4 7.05C4 7.35 4.06667 7.62533 4.2 7.876C4.33333 8.12667 4.53333 8.33467 4.8 8.5L18.95 17.35C19.2833 17.55 19.6333 17.65 20 17.65C20.3667 17.65 20.7167 17.55 21.05 17.35L35.2 8.5C35.4667 8.33333 35.6667 8.12533 35.8 7.876C35.9333 7.62667 36 7.35133 36 7.05C36 6.38333 35.7087 5.88333 35.126 5.55C34.5433 5.21667 33.968 5.23333 33.4 5.6L20 14ZM36 40C33.8 40 31.9167 39.2167 30.35 37.65C28.7833 36.0833 28 34.2 28 32V23C28 21.6 28.4833 20.4167 29.45 19.45C30.4167 18.4833 31.6 18 33 18C34.4 18 35.5833 18.4833 36.55 19.45C37.5167 20.4167 38 21.6 38 23V30C38 30.5667 37.808 31.042 37.424 31.426C37.04 31.81 36.5653 32.0013 36 32C35.4347 31.9987 34.96 31.8067 34.576 31.424C34.192 31.0413 34 30.5667 34 30V23C34 22.7333 33.9 22.5 33.7 22.3C33.5 22.1 33.2667 22 33 22C32.7333 22 32.5 22.1 32.3 22.3C32.1 22.5 32 22.7333 32 23V32C32 33.1 32.392 34.042 33.176 34.826C33.96 35.61 34.9013 36.0013 36 36C37.0987 35.9987 38.0407 35.6073 38.826 34.826C39.6113 34.0447 40.0027 33.1027 40 32V26C40 25.4333 40.192 24.9587 40.576 24.576C40.96 24.1933 41.4347 24.0013 42 24C42.5653 23.9987 43.0407 24.1907 43.426 24.576C43.8113 24.9613 44.0027 25.436 44 26V32C44 34.2 43.2167 36.0833 41.65 37.65C40.0833 39.2167 38.2 40 36 40Z" fill="currentColor"/>
                      </svg>
                    ) : null}
                  </div>
                  {!isCollapsed && (
                    <span
                      className={`text-[16px] whitespace-nowrap relative z-10 transition-colors duration-200 ease-in-out ${isActive
                          ? "text-[#1F363D] dark:text-gray-100 font-semibold"
                          : "text-white dark:text-gray-300"
                        }`}
                    >
                      {item.label}
                    </span>
                  )}
                </button>
              );
            })}
          </nav>

        </div>

        {/* Bottom Section */}
        <div className="border-t border-gray-700 dark:border-gray-800 pt-4 mt-auto p-4 pr-0 space-y-2">
          <button
            className={`w-full flex items-center ${
              isCollapsed ? "justify-center px-0" : "space-x-3 px-3"
            } py-2.5 rounded-tl-full rounded-bl-full transition-all duration-200 ease-in-out cursor-pointer hover:bg-gray-300/10 active:bg-gray-300/20 relative overflow-visible`}
          >
            <div className="w-8 h-8 rounded-full bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 flex items-center justify-center flex-shrink-0 relative z-10 transition-all duration-200 ease-in-out">
              <HelpCircle className="w-5 h-5 text-gray-900 dark:text-gray-100" />
            </div>
            {!isCollapsed && <span className="text-[16px] text-white dark:text-gray-300 whitespace-nowrap relative z-10">Help & Support</span>}
          </button>

          <button
            onClick={() => navigate(user?.role === "ADMIN" ? "/landlord/account" : "/tenant/account")}
            className={`w-full flex items-center ${
              isCollapsed ? "justify-center px-0" : "space-x-3"
            } ${
              !isCollapsed && isAccountActive ? "pl-3 pr-0" : !isCollapsed ? "px-3" : ""
            } py-2.5 rounded-tl-full rounded-bl-full transition-all duration-200 ease-in-out cursor-pointer ${
              isAccountActive 
                ? "bg-background" 
                : "hover:bg-gray-400/10 dark:hover:bg-gray-800"
            } relative overflow-visible`}
          >
            <div className={`w-8 h-8 rounded-full flex-shrink-0 relative z-10 transition-all duration-200 ease-in-out ${
              isAccountActive 
                ? "bg-[#1F363D] dark:bg-gray-100" 
                : "bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600"
            }`}>
              <div className="w-full h-full flex items-center justify-center">
                <User className={`w-5 h-5 ${isAccountActive ? "text-white dark:text-gray-900" : "text-gray-900 dark:text-gray-100"}`} />
              </div>
            </div>
            {!isCollapsed && (
              <span className={`text-[16px] whitespace-nowrap relative z-10 transition-colors duration-200 ease-in-out ${
                isAccountActive 
                  ? "text-[#1F363D] dark:text-gray-100 font-semibold" 
                  : "text-white dark:text-gray-300"
              }`}>
                Account
              </span>
            )}
          </button>

          <button
            onClick={() => setLogoutOpen(true)}
            className={`w-full flex items-center ${
              isCollapsed ? "justify-center px-0" : "space-x-3 px-3"
            } py-2.5 rounded-tl-full rounded-bl-full transition-all duration-200 ease-in-out cursor-pointer hover:bg-gray-300/10 active:bg-gray-300/20 relative overflow-visible`}
          >
            <div className="w-8 h-8 rounded-full bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 flex items-center justify-center flex-shrink-0 relative z-10 transition-all duration-200 ease-in-out">
              <LogOut className="w-5 h-5 text-gray-900 dark:text-gray-100" />
            </div>
            {!isCollapsed && <span className="text-[16px] text-white dark:text-gray-300 whitespace-nowrap relative z-10">Logout</span>}
          </button>
        </div>
      </div>

      {/* Content wrapper with proper left margin on desktop */}
      <div
        className={`transition-all duration-300 ease-in-out lg:ml-[${isCollapsed ? "70px" : "220px"
          }]`}
      />

      {/* Logout confirmation */}
      <AlertDialog open={logoutOpen} onOpenChange={setLogoutOpen}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Logout</AlertDialogTitle>
            <AlertDialogDescription>
              Are you sure you want to logout?
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel className="rounded-2xl">Cancel</AlertDialogCancel>
            <AlertDialogAction className="rounded-2xl" onClick={handleLogout}>Logout</AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </>
  );
};

export default Sidebar;
